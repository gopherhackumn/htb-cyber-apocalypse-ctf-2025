import binascii

msb_output = "00000000000001001100100000010100111100110010001101111110000000101000101001100010000011101001011011011110000001111011111011100000000101101101000000010001001110010000100111000111110100111110111111001100111110000101001101010110001100111011100011000100100100110101100100011100101000100001111101010110001010101011101011010101011110111100010011110010000110011001000010011101110011000101101000000110000111101011110011001010011100100000101000111011101010011111011001111010100110110111001111100110000001001111001101011101101111101101000001111000110001011011111110001110001100010010111010000110001100100010100000011011110001001011101011010010100110001000111111100110011101010001000111100010001111100100011011011111100010"
lsb_output = "00010100100000000010000001100110001000010110011110110101010100000100001111000000000010001001010111001010000011000010011111100110001000100111010100001011110000000000010001101010100111100000011100010100011110011101110000101011101111100000010001111001111000001000110010000000110010010100001111011001000010001110010110011101011000111010001010000000000000001000010100010011100010100011100010111110001110101001101111011001110110111110011111010000110000001010010100010110001101110110111011110011010100110011101110100011111110010100100100000010100100110010000100011011000111101011100000011100000111101110100100010010001100001011010110000010101101101111100010111011010100110010100011010001001001100100100100101101000101110111100000110001011110000111101110110"[
             ::-1]
i = 100
n = 84978369042455571089679930308597178811236624254563066058288611966008096124218219952076971220798978682877303869696449438721290478547475645968097711109962413641029045228345415642815750317320134327925145300370274356285381414031145256138717451986522016087604611330256532528187051473836697439864616356122848732889

# https://crypto.stackexchange.com/questions/11053/rsa-least-significant-bit-oracle-attack
res = 0
for char in msb_output:
    # check if plaintext < n / 2^i
    if char == "1":
        res += n >> i
    i += 1
print(binascii.unhexlify(hex(res)[2:]))

# p LSB even vs p LSB odd
# Either
# - p/2 LSB even vs p/2 LSB odd or
# - (p + N)/2 LSB even vs (p + N)/2 LSB odd

# Some math:
# (p + N)/2 LSB even ==> p + N = ...00 ==> p = ...00 - N[-2:] ?
# (p + N)/2 LSB odd  ==> p + N = ...10 ==> p = ...10 - N[-2:] ?

# In general, either
# - last even vs last odd, last := (p + x*N) / 2^i
# p = (last & 1) * 2^i - x*N

res = 0
last = 0
x = 0
for i, char in enumerate(lsb_output[1:]):
    res = ((int(char) << i) - x * n) & ((1 << (i + 1)) - 1)
    if char == "1":
        # > n/2, odd
        x += 1 << i
    # print(hex(res))
print(binascii.unhexlify("0" + hex(res)[2:]))

# Flag: HTB{1_l0v3_us1ng_RS4_0r4cl3s___3v3n_4_s1ngl3_b1t_1s_3n0ugh_t0_g3t_m3_t0_3ld0r14!_32a1ae8b3d736cb9afde31c10ed0ac50}
